{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ page.name }} - KinoCMS{% endblock %}

{% block extra_css %}
<style>
    /* Page banner styles */
    .page-banner {
        width: 100%;
        height: 400px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
        border-radius: 15px;
    }
    
    .page-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 15px;
    }
    
    .page-banner.no-image {
        background: linear-gradient(135deg, var(--card-bg) 0%, var(--secondary-color) 100%);
        color: var(--text-color);
        text-align: center;
        padding: 2rem;
    }
    
    .page-banner.no-image i {
        font-size: 4rem;
        color: var(--accent-color);
        margin-bottom: 1rem;
    }
    
    /* Page title styles */
    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-color);
        margin-bottom: 2rem;
        text-align: center;
        position: relative;
    }
    
    .page-title::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 3px;
        background: var(--accent-color);
        border-radius: 2px;
    }
    
    /* Page description styles */
    .page-description {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--text-color);
        margin-bottom: 3rem;
        padding: 2rem;
        background: var(--card-bg);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .page-description p {
        margin-bottom: 1rem;
    }
    
    .page-description p:last-child {
        margin-bottom: 0;
    }
    
    /* Gallery styles */
    .page-gallery {
        margin-top: 3rem;
    }
    
    .gallery-title {
        font-size: 2rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 2rem;
    }
    
    .gallery-item {
        position: relative;
        border-radius: 15px;
        overflow: hidden;
        background: var(--card-bg);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .gallery-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .gallery-item img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .gallery-item:hover img {
        transform: scale(1.1);
    }
    
    /* Modal styles for gallery */
    .gallery-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
    }
    
    .gallery-modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .gallery-modal-content {
        max-width: 90%;
        max-height: 90%;
        border-radius: 10px;
        position: relative;
    }
    
    .gallery-modal-content img {
        width: 100%;
        height: auto;
        border-radius: 10px;
    }
    
    .gallery-modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        padding: 10px;
        transition: color 0.3s ease;
    }
    
    .gallery-modal-close:hover {
        color: var(--accent-color);
    }
    
    /* No content states */
    .no-description {
        text-align: center;
        color: var(--text-muted);
        font-style: italic;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        margin-bottom: 3rem;
    }
    
    .no-gallery {
        text-align: center;
        color: var(--text-muted);
        font-style: italic;
        padding: 3rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
        .page-banner {
            height: 250px;
        }
        
        .page-title {
            font-size: 2rem;
        }
        
        .page-description {
            padding: 1.5rem;
            font-size: 1rem;
        }
        
        .gallery-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .gallery-item img {
            height: 200px;
        }
    }
    
    @media (max-width: 480px) {
        .page-banner {
            height: 200px;
            border-radius: 10px;
        }
        
        .page-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }
        
        .page-description {
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .gallery-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Banner -->
    <div class="page-banner {% if not page.logo %}no-image{% endif %}">
        {% if page.logo %}
            <img src="{{ page.logo.url }}" alt="{{ page.name }}">
        {% else %}
            <div>
                <i class="fas fa-image"></i>
                <p class="mb-0">{% trans "Изображение недоступно" %}</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Page Title -->
    <h1 class="page-title">
        {% get_current_language as LANGUAGE_CODE %}
        {% if LANGUAGE_CODE == 'uk' and page.name_uk %}
            {{ page.name_uk }}
        {% else %}
            {{ page.name }}
        {% endif %}
    </h1>
    
    <!-- Page Description -->
    {% if page.description %}
        <div class="page-description">
            {% get_current_language as LANGUAGE_CODE %}
            {% if LANGUAGE_CODE == 'uk' and page.description_uk %}
                {{ page.description_uk|linebreaks }}
            {% else %}
                {{ page.description|linebreaks }}
            {% endif %}
        </div>
    {% else %}
        <div class="no-description">
            <i class="fas fa-info-circle me-2"></i>
            {% trans "Описание для данной страницы пока не добавлено." %}
        </div>
    {% endif %}
    
    <!-- Photo Gallery -->
    {% if page.gallery and page.gallery.images.exists %}
        <div class="page-gallery">
            <h2 class="gallery-title">
                <i class="fas fa-images me-2"></i>
                {% trans "Фотогалерея" %}
            </h2>
            
            <div class="gallery-grid">
                {% for image in page.gallery.images.all %}
                    <div class="gallery-item" onclick="openGalleryModal('{{ image.image.url }}')">
                        <img src="{{ image.image.url }}" alt="{% trans 'Изображение галереи' %} {{ forloop.counter }}">
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="no-gallery">
            <i class="fas fa-images me-2"></i>
            {% trans "Фотогалерея для данной страницы пока не добавлена." %}
        </div>
    {% endif %}
</div>

<!-- Gallery Modal -->
<div class="gallery-modal" id="galleryModal" onclick="closeGalleryModal()">
    <div class="gallery-modal-content">
        <span class="gallery-modal-close" onclick="closeGalleryModal()">&times;</span>
        <img id="galleryModalImage" src="" alt="{% trans 'Полное изображение' %}">
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Gallery modal functionality
    function openGalleryModal(imageSrc) {
        const modal = document.getElementById('galleryModal');
        const modalImage = document.getElementById('galleryModalImage');
        
        modalImage.src = imageSrc;
        modal.classList.add('active');
        
        // Prevent body scrolling
        document.body.style.overflow = 'hidden';
    }
    
    function closeGalleryModal() {
        const modal = document.getElementById('galleryModal');
        modal.classList.remove('active');
        
        // Restore body scrolling
        document.body.style.overflow = 'auto';
    }
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeGalleryModal();
        }
    });
    
    // Prevent modal content click from closing modal
    document.querySelector('.gallery-modal-content').addEventListener('click', function(e) {
        e.stopPropagation();
    });
</script>
{% endblock %}