{% extends 'core/admin_base.html' %}
{% load static %}

{% block title %}{{ title }} - KinoCMS{% endblock %}

{% block page_title %}{{ title }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'core:admin_dashboard' %}">Главная</a></li>
<li class="breadcrumb-item"><a href="{% url 'page:admin_list' %}">Страницы</a></li>
<li class="breadcrumb-item active">{{ title }}</li>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-12">
    <div class="card card-primary">
      <div class="card-header">
        <h3 class="card-title">{{ title }}</h3>
        <div class="card-tools">
          <a href="{% url 'page:admin_list' %}" class="btn btn-sm btn-secondary">
            <i class="fas fa-arrow-left"></i> Назад к списку
          </a>
        </div>
      </div>
      <!-- /.card-header -->
      <!-- form start -->
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="card-body">
          {% if form.errors %}
            <div class="alert alert-danger alert-dismissible">
              <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
              <h5><i class="icon fas fa-ban"></i> Ошибки в форме!</h5>
              {% for field in form %}
                {% if field.errors %}
                  <strong>{{ field.label }}:</strong>
                  {% for error in field.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                {% endif %}
              {% endfor %}
              {% if form.non_field_errors %}
                {% for error in form.non_field_errors %}
                  <p>{{ error }}</p>
                {% endfor %}
              {% endif %}
            </div>
          {% endif %}
          
          <!-- Основные поля формы -->
          {% for field in form %}
            <div class="form-group">
              {{ field.label_tag }}
              {{ field }}
              {% if field.help_text %}
                <small class="form-text text-muted">{{ field.help_text }}</small>
              {% endif %}
              {% if field.errors %}
                {% for error in field.errors %}
                  <div class="invalid-feedback d-block">{{ error }}</div>
                {% endfor %}
              {% endif %}
            </div>
          {% endfor %}
          
        </div>
        <!-- /.card-body -->

        <div class="card-footer">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i>
            {% if is_create %}Создать{% else %}Сохранить изменения{% endif %}
          </button>
          <a href="{% url 'page:admin_list' %}" class="btn btn-secondary ml-2">
            <i class="fas fa-times"></i> Отмена
          </a>
        </div>
      </form>
    </div>
    <!-- /.card -->
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Автоматически скрывать алерты через 5 секунд
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        setTimeout(function() {
            if (alert && alert.parentNode) {
                alert.style.transition = 'opacity 0.5s';
                alert.style.opacity = '0';
                setTimeout(function() {
                    if (alert && alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 500);
            }
        }, 5000);
    });
});
</script>
{% endblock %}